<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Redux Real-World Example Project Teardown by stlouisweb</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Redux Real-World Example Project Teardown</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/stlouisweb/redux-real-world-teardown" class="btn">View on GitHub</a>
      <a href="https://github.com/stlouisweb/redux-real-world-teardown/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/stlouisweb/redux-real-world-teardown/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>Here is a walk-through of the <a href="https://github.com/reactjs/redux/tree/master/examples/real-world">Real-World example Redux project</a>.</p>

<h2>
<a id="project-set-up" class="anchor" href="#project-set-up" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Project set up</h2>

<h3>
<a id="boilerplate" class="anchor" href="#boilerplate" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Boilerplate</h3>

<p>At the root of the project are the following "boilerplate" files that can be used in your own React-Redux projects in more-less the same form.</p>

<h4>
<a id="packagejson" class="anchor" href="#packagejson" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>./package.json</h4>

<div class="highlight highlight-source-json"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>redux-real-world-example<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>0.0.0<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Redux real-world example<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>scripts<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>start<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>node server.js<span class="pl-pds">"</span></span>
  },
  <span class="pl-s"><span class="pl-pds">"</span>repository<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>git<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://github.com/reactjs/redux.git<span class="pl-pds">"</span></span>
  },
  <span class="pl-s"><span class="pl-pds">"</span>license<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>MIT<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>bugs<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://github.com/reactjs/redux/issues<span class="pl-pds">"</span></span>
  },
  <span class="pl-s"><span class="pl-pds">"</span>homepage<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://redux.js.org<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>dependencies<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>babel-polyfill<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^6.3.14<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>humps<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^0.6.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>isomorphic-fetch<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^2.1.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>lodash<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^4.0.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>normalizr<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^2.0.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>react<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^0.14.7<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>react-dom<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^0.14.7<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>react-redux<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^4.2.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>react-router<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>2.0.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>react-router-redux<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^4.0.0-rc.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>redux<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^3.2.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>redux-logger<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^2.4.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>redux-thunk<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^1.0.3<span class="pl-pds">"</span></span>
  },
  <span class="pl-s"><span class="pl-pds">"</span>devDependencies<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>babel-core<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^6.3.15<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>babel-loader<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^6.2.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>babel-preset-es2015<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^6.3.13<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>babel-preset-react<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^6.3.13<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>babel-preset-react-hmre<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^1.1.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>concurrently<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^0.1.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>express<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^4.13.3<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>redux-devtools<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^3.1.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>redux-devtools-dock-monitor<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^1.0.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>redux-devtools-log-monitor<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^1.0.3<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>webpack<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^1.9.11<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>webpack-dev-middleware<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^1.2.0<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>webpack-hot-middleware<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>^2.9.1<span class="pl-pds">"</span></span>
  }
}</pre></div>

<h4>
<a id="babelrc" class="anchor" href="#babelrc" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>./.babelrc</h4>

<pre><code>{
  "presets": ["es2015", "react"],
  "env": {
    "development": {
      "presets": ["react-hmre"]
    }
  }
}
</code></pre>

<h4>
<a id="webpackconfigjs" class="anchor" href="#webpackconfigjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>./webpack.config.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> webpack <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
  devtool<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>cheap-module-eval-source-map<span class="pl-pds">'</span></span>,
  entry<span class="pl-k">:</span> [
    <span class="pl-s"><span class="pl-pds">'</span>webpack-hot-middleware/client<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>./index<span class="pl-pds">'</span></span>,
  ],
  output<span class="pl-k">:</span> {
    path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>dist<span class="pl-pds">'</span></span>),
    filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>bundle.js<span class="pl-pds">'</span></span>,
    publicPath<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/static/<span class="pl-pds">'</span></span>,
  },
  plugins<span class="pl-k">:</span> [
    <span class="pl-k">new</span> <span class="pl-en">webpack.optimize</span>.<span class="pl-en">OccurenceOrderPlugin</span>(),
    <span class="pl-k">new</span> <span class="pl-en">webpack.HotModuleReplacementPlugin</span>(),
  ],
  module<span class="pl-k">:</span> {
    loaders<span class="pl-k">:</span> [
      {
        test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>js<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
        loaders<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>babel<span class="pl-pds">'</span></span>],
        exclude<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span>node_modules<span class="pl-pds">/</span></span>,
        include<span class="pl-k">:</span> <span class="pl-c1">__dirname</span>,
      },
    ],
  },
};</pre></div>

<h4>
<a id="indexhtml" class="anchor" href="#indexhtml" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>./index.html</h4>

<div class="highlight highlight-text-html-basic"><pre>&lt;!DOCTYPE html&gt;
&lt;<span class="pl-ent">html</span>&gt;
  &lt;<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">title</span>&gt;Redux real-world example&lt;/<span class="pl-ent">title</span>&gt;
  &lt;/<span class="pl-ent">head</span>&gt;
  &lt;<span class="pl-ent">body</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>root<span class="pl-pds">"</span></span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
<span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>/static/bundle.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span>
  &lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>

<h4>
<a id="indexjs" class="anchor" href="#indexjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>./index.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">'</span>babel-polyfill<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">render</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">browserHistory</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">syncHistoryWithStore</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router-redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Root</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./containers/Root<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">configureStore</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./store/configureStore<span class="pl-pds">'</span></span>;

<span class="pl-k">const</span> <span class="pl-c1">store</span> <span class="pl-k">=</span> <span class="pl-en">configureStore</span>();
<span class="pl-k">const</span> <span class="pl-c1">history</span> <span class="pl-k">=</span> <span class="pl-en">syncHistoryWithStore</span>(browserHistory, store);

<span class="pl-en">render</span>(
  <span class="pl-k">&lt;</span>Root store<span class="pl-k">=</span>{store} history<span class="pl-k">=</span>{history} <span class="pl-k">/</span><span class="pl-k">&gt;</span>,
  <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>root<span class="pl-pds">'</span></span>)
);
</pre></div>

<h4>
<a id="serverjs" class="anchor" href="#serverjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>server.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> webpack <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> webpackDevMiddleware <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack-dev-middleware<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> webpackHotMiddleware <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack-hot-middleware<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> config <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./webpack.config<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> app <span class="pl-k">=</span> <span class="pl-k">new</span> (<span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>express<span class="pl-pds">'</span></span>))();
<span class="pl-k">var</span> port <span class="pl-k">=</span> <span class="pl-c1">3000</span>;

<span class="pl-k">var</span> compiler <span class="pl-k">=</span> <span class="pl-en">webpack</span>(config);
<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-en">webpackDevMiddleware</span>(compiler, { noInfo<span class="pl-k">:</span> <span class="pl-c1">true</span>, publicPath<span class="pl-k">:</span> <span class="pl-smi">config</span>.<span class="pl-smi">output</span>.<span class="pl-smi">publicPath</span> }));
<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-en">webpackHotMiddleware</span>(compiler));

<span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {
  <span class="pl-smi">res</span>.<span class="pl-en">sendFile</span>(<span class="pl-c1">__dirname</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>/index.html<span class="pl-pds">'</span></span>);
});

<span class="pl-smi">app</span>.<span class="pl-en">listen</span>(port, <span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
  <span class="pl-k">if</span> (error) {
    <span class="pl-en">console</span>.<span class="pl-c1">error</span>(error);
  } <span class="pl-k">else</span> {
    <span class="pl-en">console</span>.<span class="pl-c1">info</span>(<span class="pl-s"><span class="pl-pds">'</span>==&gt; ðŸŒŽ  Listening on port %s. Open up http://localhost:%s/ in your browser.<span class="pl-pds">'</span></span>,
    port, port);
  }
});
</pre></div>

<h4>
<a id="routesjs" class="anchor" href="#routesjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>routes.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> { <span class="pl-smi">Route</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">App</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./containers/App<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">UserPage</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./containers/UserPage<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">RepoPage</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./containers/RepoPage<span class="pl-pds">'</span></span>

<span class="pl-k">export</span> <span class="pl-v">default</span> (
  <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{App}<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/:login/:name<span class="pl-pds">"</span></span>
           component<span class="pl-k">=</span>{RepoPage} <span class="pl-k">/</span><span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/:login<span class="pl-pds">"</span></span>
           component<span class="pl-k">=</span>{UserPage} <span class="pl-k">/</span><span class="pl-k">&gt;</span>
  <span class="pl-k">&lt;</span><span class="pl-k">/</span>Route<span class="pl-k">&gt;</span>
)
</pre></div>

<p>You'll see some project specific routes in routes.js.</p>

<hr>

<h3>
<a id="directory-structure" class="anchor" href="#directory-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Directory Structure</h3>

<pre><code>real-world/
 |---- actions/
 |---- components/
 |---- containers/
 |---- middleware/
 |---- reducers/
 |---- store/
 |---- .babelrc
 |---- index.html
 |---- index.js
 |---- package.json
 |---- routes.js
 |---- server.js
 |---- webpack.config.js

</code></pre>

<hr>

<h3>
<a id="accessing-the-github-api" class="anchor" href="#accessing-the-github-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Accessing the Github API</h3>

<p>The middleware directory is project specific, in this case, we'll be interacting with the Github API to query for users and get a list of repositories they follow.</p>

<pre><code>real-world/
...
|---- middleware/
      |---- api.js
...
</code></pre>

<h4>
<a id="apijs" class="anchor" href="#apijs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>api.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">import</span> { <span class="pl-smi">Schema</span>, <span class="pl-smi">arrayOf</span>, <span class="pl-smi">normalize</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>normalizr<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">camelizeKeys</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>humps<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">'</span>isomorphic-fetch<span class="pl-pds">'</span></span>;

<span class="pl-c">// Extracts the next page URL from Github API response.</span>
<span class="pl-k">function</span> <span class="pl-en">getNextPageUrl</span>(<span class="pl-smi">response</span>) {
  <span class="pl-k">const</span> <span class="pl-c1">link</span> <span class="pl-k">=</span> <span class="pl-smi">response</span>.<span class="pl-c1">headers</span>.<span class="pl-en">get</span>(<span class="pl-s"><span class="pl-pds">'</span>link<span class="pl-pds">'</span></span>);
  <span class="pl-k">if</span> (<span class="pl-k">!</span>link) {
    <span class="pl-k">return</span> <span class="pl-c1">null</span>;
  }

  <span class="pl-k">const</span> <span class="pl-c1">nextLink</span> <span class="pl-k">=</span> <span class="pl-smi">link</span>.<span class="pl-c1">split</span>(<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>).<span class="pl-c1">find</span>(<span class="pl-smi">s</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">s</span>.<span class="pl-c1">indexOf</span>(<span class="pl-s"><span class="pl-pds">'</span>rel="next"<span class="pl-pds">'</span></span>) <span class="pl-k">&gt;</span> <span class="pl-k">-</span><span class="pl-c1">1</span>);
  <span class="pl-k">if</span> (<span class="pl-k">!</span>nextLink) {
    <span class="pl-k">return</span> <span class="pl-c1">null</span>;
  }

  <span class="pl-k">return</span> <span class="pl-smi">nextLink</span>.<span class="pl-c1">split</span>(<span class="pl-s"><span class="pl-pds">'</span>;<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>].<span class="pl-c1">slice</span>(<span class="pl-c1">1</span>, <span class="pl-k">-</span><span class="pl-c1">1</span>);
}

<span class="pl-k">const</span> <span class="pl-c1">API_ROOT</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>https://api.github.com/<span class="pl-pds">'</span></span>;

<span class="pl-c">// Fetches an API response and normalizes the result JSON according to the schema.</span>
<span class="pl-c">// This makes every API response have the same shape, regardless of how nested it was.</span>
<span class="pl-k">function</span> <span class="pl-en">callApi</span>(<span class="pl-smi">endpoint</span>, <span class="pl-smi">schema</span>) {
  <span class="pl-k">const</span> <span class="pl-c1">fullUrl</span> <span class="pl-k">=</span> (<span class="pl-smi">endpoint</span>.<span class="pl-c1">indexOf</span>(<span class="pl-c1">API_ROOT</span>) <span class="pl-k">===</span> <span class="pl-k">-</span><span class="pl-c1">1</span>) <span class="pl-k">?</span> <span class="pl-c1">API_ROOT</span> <span class="pl-k">+</span> endpoint <span class="pl-k">:</span> endpoint;

  <span class="pl-k">return</span> <span class="pl-en">fetch</span>(fullUrl)
    .<span class="pl-en">then</span>(<span class="pl-smi">response</span> <span class="pl-k">=&gt;</span>
      <span class="pl-smi">response</span>.<span class="pl-en">json</span>().<span class="pl-en">then</span>(<span class="pl-smi">json</span> <span class="pl-k">=&gt;</span> ({ json, response }))
    ).<span class="pl-en">then</span>(({ json, response }) <span class="pl-k">=&gt;</span> {
      <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">response</span>.<span class="pl-smi">ok</span>) {
        <span class="pl-k">return</span> <span class="pl-smi">Promise</span>.<span class="pl-en">reject</span>(json);
      }

      <span class="pl-k">const</span> <span class="pl-c1">camelizedJson</span> <span class="pl-k">=</span> <span class="pl-en">camelizeKeys</span>(json);
      <span class="pl-k">const</span> <span class="pl-c1">nextPageUrl</span> <span class="pl-k">=</span> <span class="pl-en">getNextPageUrl</span>(response);

      <span class="pl-k">return</span> <span class="pl-c1">Object</span>.<span class="pl-en">assign</span>({},
        <span class="pl-en">normalize</span>(camelizedJson, schema),
        { nextPageUrl }
      );
    });
}

<span class="pl-c">// We use this Normalizr schemas to transform API responses from a nested form</span>
<span class="pl-c">// to a flat form where repos and users are placed in `entities`, and nested</span>
<span class="pl-c">// JSON objects are replaced with their IDs. This is very convenient for</span>
<span class="pl-c">// consumption by reducers, because we can easily build a normalized tree</span>
<span class="pl-c">// and keep it updated as we fetch more data.</span>

<span class="pl-c">// Read more about Normalizr: https://github.com/gaearon/normalizr</span>

<span class="pl-c">// GitHub's API may return results with uppercase letters while the query</span>
<span class="pl-c">// doesn't contain any. For example, "someuser" could result in "SomeUser"</span>
<span class="pl-c">// leading to a frozen UI as it wouldn't find "someuser" in the entities.</span>
<span class="pl-c">// That's why we're forcing lower cases down there.</span>

<span class="pl-k">const</span> <span class="pl-c1">userSchema</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Schema</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, {
  <span class="pl-en">idAttribute</span><span class="pl-k">:</span> <span class="pl-smi">user</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">user</span>.<span class="pl-smi">login</span>.<span class="pl-c1">toLowerCase</span>(),
});

<span class="pl-k">const</span> <span class="pl-c1">repoSchema</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Schema</span>(<span class="pl-s"><span class="pl-pds">'</span>repos<span class="pl-pds">'</span></span>, {
  <span class="pl-en">idAttribute</span><span class="pl-k">:</span> <span class="pl-smi">repo</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">repo</span>.<span class="pl-smi">fullName</span>.<span class="pl-c1">toLowerCase</span>(),
});

<span class="pl-smi">repoSchema</span>.<span class="pl-en">define</span>({
  owner<span class="pl-k">:</span> userSchema,
});

<span class="pl-c">// Schemas for Github API responses.</span>
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">Schemas</span> <span class="pl-k">=</span> {
  USER<span class="pl-k">:</span> userSchema,
  USER_ARRAY<span class="pl-k">:</span> <span class="pl-en">arrayOf</span>(userSchema),
  REPO<span class="pl-k">:</span> repoSchema,
  REPO_ARRAY<span class="pl-k">:</span> <span class="pl-en">arrayOf</span>(repoSchema),
};

<span class="pl-c">// Action key that carries API call info interpreted by this Redux middleware.</span>
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">CALL_API</span> <span class="pl-k">=</span> <span class="pl-c1">Symbol</span>(<span class="pl-s"><span class="pl-pds">'</span>Call API<span class="pl-pds">'</span></span>);

<span class="pl-c">// A Redux middleware that interprets actions with CALL_API info specified.</span>
<span class="pl-c">// Performs the call and promises when such actions are dispatched.</span>
<span class="pl-k">export</span> <span class="pl-v">default</span> <span class="pl-smi">store</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">next</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">action</span> <span class="pl-k">=&gt;</span> {
  <span class="pl-k">const</span> <span class="pl-c1">callAPI</span> <span class="pl-k">=</span> action[<span class="pl-c1">CALL_API</span>];
  <span class="pl-k">if</span> (<span class="pl-k">typeof</span> callAPI <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>undefined<span class="pl-pds">'</span></span>) {
    <span class="pl-k">return</span> <span class="pl-en">next</span>(action);
  }

  <span class="pl-k">let</span> { endpoint } <span class="pl-k">=</span> callAPI;
  <span class="pl-k">const</span> { <span class="pl-c1">schema</span>, <span class="pl-c1">types</span> } <span class="pl-k">=</span> callAPI;

  <span class="pl-k">if</span> (<span class="pl-k">typeof</span> endpoint <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>function<span class="pl-pds">'</span></span>) {
    endpoint <span class="pl-k">=</span> <span class="pl-en">endpoint</span>(<span class="pl-smi">store</span>.<span class="pl-en">getState</span>());
  }

  <span class="pl-k">if</span> (<span class="pl-k">typeof</span> endpoint <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Specify a string endpoint URL.<span class="pl-pds">'</span></span>);
  }

  <span class="pl-k">if</span> (<span class="pl-k">!</span>schema) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Specify one of the exported Schemas.<span class="pl-pds">'</span></span>);
  }

  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">Array</span>.<span class="pl-en">isArray</span>(types) <span class="pl-k">||</span> <span class="pl-smi">types</span>.<span class="pl-c1">length</span> <span class="pl-k">!==</span> <span class="pl-c1">3</span>) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Expected an array of three action types.<span class="pl-pds">'</span></span>);
  }

  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">types</span>.<span class="pl-en">every</span>(<span class="pl-smi">type</span> <span class="pl-k">=&gt;</span> <span class="pl-k">typeof</span> type <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>)) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Expected action types to be strings.<span class="pl-pds">'</span></span>);
  }

  <span class="pl-k">function</span> <span class="pl-en">actionWith</span>(<span class="pl-smi">data</span>) {
    <span class="pl-k">const</span> <span class="pl-c1">finalAction</span> <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-en">assign</span>({}, action, data);
    <span class="pl-k">delete</span> finalAction[<span class="pl-c1">CALL_API</span>];
    <span class="pl-k">return</span> finalAction;
  }

  <span class="pl-k">const</span> [<span class="pl-c1">requestType</span>, <span class="pl-c1">successType</span>, <span class="pl-c1">failureType</span>] <span class="pl-k">=</span> types;
  <span class="pl-en">next</span>(<span class="pl-en">actionWith</span>({ type<span class="pl-k">:</span> requestType }));

  <span class="pl-k">return</span> <span class="pl-en">callApi</span>(endpoint, schema).<span class="pl-en">then</span>(
    <span class="pl-smi">response</span> <span class="pl-k">=&gt;</span> <span class="pl-en">next</span>(<span class="pl-en">actionWith</span>({
      response,
      type<span class="pl-k">:</span> successType,
    })),
    <span class="pl-smi">error</span> <span class="pl-k">=&gt;</span> <span class="pl-en">next</span>(<span class="pl-en">actionWith</span>({
      type<span class="pl-k">:</span> failureType,
      error<span class="pl-k">:</span> <span class="pl-smi">error</span>.<span class="pl-smi">message</span> <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>Something bad happened<span class="pl-pds">'</span></span>,
    }))
  );
};
</pre></div>

<hr>

<h3>
<a id="configuring-the-store" class="anchor" href="#configuring-the-store" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuring the store</h3>

<p>Redux uses a single "Store", here's how they set it up:</p>

<pre><code>real-world/
...
|---- reducers/
|---- store/
      |---- configureStore.js
      |---- congifureStore.dev.js
      |---- configureStore.prod.js
...
</code></pre>

<p>The configureStore.js file simply checks if the environment is labeled production, and if so requires the configureStore.prod.js configuration, otherwise it loads configureStore.dev.js. The primary difference between prod and dev is more logging and hot module replacement in dev.</p>

<h4>
<a id="configurestorejs" class="anchor" href="#configurestorejs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>configureStore.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">if</span> (<span class="pl-c1">process</span>.<span class="pl-smi">env</span>.<span class="pl-c1">NODE_ENV</span> <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>production<span class="pl-pds">'</span></span>) {
  <span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./configureStore.prod<span class="pl-pds">'</span></span>)
} <span class="pl-k">else</span> {
  <span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./configureStore.dev<span class="pl-pds">'</span></span>)
}</pre></div>

<h4>
<a id="configurestoredevjs" class="anchor" href="#configurestoredevjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>configureStore.dev.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">import</span> { <span class="pl-smi">createStore</span>, <span class="pl-smi">applyMiddleware</span>, <span class="pl-smi">compose</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">thunk</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux-thunk<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">createLogger</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux-logger<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">api</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../middleware/api<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">rootReducer</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../reducers<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">DevTools</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../containers/DevTools<span class="pl-pds">'</span></span>

<span class="pl-k">export</span> <span class="pl-v">default</span> <span class="pl-k">function</span> <span class="pl-en">configureStore</span>(<span class="pl-smi">initialState</span>) {
  <span class="pl-k">const</span> <span class="pl-c1">store</span> <span class="pl-k">=</span> <span class="pl-en">createStore</span>(
    rootReducer,
    initialState,
    <span class="pl-en">compose</span>(
      <span class="pl-en">applyMiddleware</span>(thunk, api, <span class="pl-en">createLogger</span>()),
      <span class="pl-smi">DevTools</span>.<span class="pl-en">instrument</span>()
    )
  )

  <span class="pl-k">if</span> (<span class="pl-c1">module</span>.<span class="pl-smi">hot</span>) {
    <span class="pl-c">// Enable Webpack hot module replacement for reducers</span>
    <span class="pl-c1">module</span>.<span class="pl-smi">hot</span>.<span class="pl-c1">accept</span>(<span class="pl-s"><span class="pl-pds">'</span>../reducers<span class="pl-pds">'</span></span>, () <span class="pl-k">=&gt;</span> {
      <span class="pl-k">const</span> <span class="pl-c1">nextRootReducer</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>../reducers<span class="pl-pds">'</span></span>).<span class="pl-smi">default</span>
      <span class="pl-smi">store</span>.<span class="pl-en">replaceReducer</span>(nextRootReducer)
    })
  }

  <span class="pl-k">return</span> store
}</pre></div>

<h4>
<a id="configurestoreprodjs" class="anchor" href="#configurestoreprodjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>configureStore.prod.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">import</span> { <span class="pl-smi">createStore</span>, <span class="pl-smi">applyMiddleware</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">thunk</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux-thunk<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">api</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../middleware/api<span class="pl-pds">'</span></span>
<span class="pl-k">import</span> <span class="pl-smi">rootReducer</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../reducers<span class="pl-pds">'</span></span>

<span class="pl-k">export</span> <span class="pl-v">default</span> <span class="pl-k">function</span> <span class="pl-en">configureStore</span>(<span class="pl-smi">initialState</span>) {
  <span class="pl-k">return</span> <span class="pl-en">createStore</span>(
    rootReducer,
    initialState,
    <span class="pl-en">applyMiddleware</span>(thunk, api)
  )
}
</pre></div>

<hr>

<h3>
<a id="configuring-the-reducers" class="anchor" href="#configuring-the-reducers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuring the reducers</h3>

<p>In Redux reducers handle events generated by actions to  update the application's state.</p>

<pre><code>real-world/
...
|---- reducers/
      |---- index.js
      |---- paginate.js
...
</code></pre>

<h4>
<a id="indexjs-1" class="anchor" href="#indexjs-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>index.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">import</span> <span class="pl-v">*</span> <span class="pl-k">as</span> <span class="pl-smi">ActionTypes</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../actions<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">merge</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>lodash/merge<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">paginate</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./paginate<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">routerReducer</span> <span class="pl-k">as</span> <span class="pl-smi">routing</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router-redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">combineReducers</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>;

<span class="pl-c">// Updates an entity cache in response to any action with response.entities.</span>
<span class="pl-k">function</span> <span class="pl-en">entities</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> { users<span class="pl-k">:</span> {}, repos<span class="pl-k">:</span> {} }, <span class="pl-smi">action</span>) {
  <span class="pl-k">if</span> (<span class="pl-smi">action</span>.<span class="pl-smi">response</span> <span class="pl-k">&amp;&amp;</span> <span class="pl-smi">action</span>.<span class="pl-smi">response</span>.<span class="pl-c1">entities</span>) {
    <span class="pl-k">return</span> <span class="pl-en">merge</span>({}, state, <span class="pl-smi">action</span>.<span class="pl-smi">response</span>.<span class="pl-c1">entities</span>);
  }

  <span class="pl-k">return</span> state;
}

<span class="pl-c">// Updates error message to notify about the failed fetches.</span>
<span class="pl-k">function</span> <span class="pl-en">errorMessage</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>, <span class="pl-smi">action</span>) {
  <span class="pl-k">const</span> { <span class="pl-c1">type</span>, <span class="pl-c1">error</span> } <span class="pl-k">=</span> action;

  <span class="pl-k">if</span> (type <span class="pl-k">===</span> <span class="pl-smi">ActionTypes</span>.<span class="pl-c1">RESET_ERROR_MESSAGE</span>) {
    <span class="pl-k">return</span> <span class="pl-c1">null</span>;
  } <span class="pl-k">else</span> <span class="pl-k">if</span> (error) {
    <span class="pl-k">return</span> <span class="pl-smi">action</span>.<span class="pl-smi">error</span>;
  }

  <span class="pl-k">return</span> state;
}

<span class="pl-c">// Updates the pagination data for different actions.</span>
<span class="pl-k">const</span> <span class="pl-c1">pagination</span> <span class="pl-k">=</span> <span class="pl-en">combineReducers</span>({
  starredByUser<span class="pl-k">:</span> <span class="pl-en">paginate</span>({
    <span class="pl-en">mapActionToKey</span><span class="pl-k">:</span> <span class="pl-smi">action</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">action</span>.<span class="pl-smi">login</span>,
    types<span class="pl-k">:</span> [
      <span class="pl-smi">ActionTypes</span>.<span class="pl-c1">STARRED_REQUEST</span>,
      <span class="pl-smi">ActionTypes</span>.<span class="pl-c1">STARRED_SUCCESS</span>,
      <span class="pl-smi">ActionTypes</span>.<span class="pl-c1">STARRED_FAILURE</span>,
    ],
  }),
  stargazersByRepo<span class="pl-k">:</span> <span class="pl-en">paginate</span>({
    <span class="pl-en">mapActionToKey</span><span class="pl-k">:</span> <span class="pl-smi">action</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">action</span>.<span class="pl-smi">fullName</span>,
    types<span class="pl-k">:</span> [
      <span class="pl-smi">ActionTypes</span>.<span class="pl-c1">STARGAZERS_REQUEST</span>,
      <span class="pl-smi">ActionTypes</span>.<span class="pl-c1">STARGAZERS_SUCCESS</span>,
      <span class="pl-smi">ActionTypes</span>.<span class="pl-c1">STARGAZERS_FAILURE</span>,
    ],
  }),
});

<span class="pl-k">const</span> <span class="pl-c1">rootReducer</span> <span class="pl-k">=</span> <span class="pl-en">combineReducers</span>({
  entities,
  pagination,
  errorMessage,
  routing,
});

<span class="pl-k">export</span> <span class="pl-v">default</span> <span class="pl-smi">rootReducer</span>;
</pre></div>

<h4>
<a id="paginatejs" class="anchor" href="#paginatejs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>paginate.js</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-k">import</span> <span class="pl-smi">merge</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>lodash/merge<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">union</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>lodash/union<span class="pl-pds">'</span></span>;

<span class="pl-c">// Creates a reducer managing pagination, given the action types to handle,</span>
<span class="pl-c">// and a function telling how to extract the key from an action.</span>
<span class="pl-k">export</span> <span class="pl-v">default</span> <span class="pl-k">function</span> <span class="pl-en">paginate</span>({ types, mapActionToKey }) {
  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">Array</span>.<span class="pl-en">isArray</span>(types) <span class="pl-k">||</span> <span class="pl-smi">types</span>.<span class="pl-c1">length</span> <span class="pl-k">!==</span> <span class="pl-c1">3</span>) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Expected types to be an array of three elements.<span class="pl-pds">'</span></span>);
  }

  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">types</span>.<span class="pl-en">every</span>(<span class="pl-smi">t</span> <span class="pl-k">=&gt;</span> <span class="pl-k">typeof</span> t <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>)) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Expected types to be strings.<span class="pl-pds">'</span></span>);
  }

  <span class="pl-k">if</span> (<span class="pl-k">typeof</span> mapActionToKey <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">'</span>function<span class="pl-pds">'</span></span>) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Expected mapActionToKey to be a function.<span class="pl-pds">'</span></span>);
  }

  <span class="pl-k">const</span> [<span class="pl-c1">requestType</span>, <span class="pl-c1">successType</span>, <span class="pl-c1">failureType</span>] <span class="pl-k">=</span> types;

  <span class="pl-k">function</span> <span class="pl-en">updatePagination</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> {
    isFetching<span class="pl-k">:</span> <span class="pl-c1">false</span>,
    nextPageUrl<span class="pl-k">:</span> <span class="pl-c1">undefined</span>,
    pageCount<span class="pl-k">:</span> <span class="pl-c1">0</span>,
    ids<span class="pl-k">:</span> [],
  }, <span class="pl-smi">action</span>) {
    <span class="pl-k">switch</span> (<span class="pl-smi">action</span>.<span class="pl-c1">type</span>) {
      <span class="pl-k">case</span> requestType<span class="pl-k">:</span>
        <span class="pl-k">return</span> <span class="pl-en">merge</span>({}, state, {
          isFetching<span class="pl-k">:</span> <span class="pl-c1">true</span>,
        });
      <span class="pl-k">case</span> successType<span class="pl-k">:</span>
        <span class="pl-k">return</span> <span class="pl-en">merge</span>({}, state, {
          isFetching<span class="pl-k">:</span> <span class="pl-c1">false</span>,
          ids<span class="pl-k">:</span> <span class="pl-en">union</span>(<span class="pl-smi">state</span>.<span class="pl-c1">ids</span>, <span class="pl-smi">action</span>.<span class="pl-smi">response</span>.<span class="pl-smi">result</span>),
          nextPageUrl<span class="pl-k">:</span> <span class="pl-smi">action</span>.<span class="pl-smi">response</span>.<span class="pl-smi">nextPageUrl</span>,
          pageCount<span class="pl-k">:</span> <span class="pl-smi">state</span>.<span class="pl-smi">pageCount</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>,
        });
      <span class="pl-k">case</span> failureType<span class="pl-k">:</span>
        <span class="pl-k">return</span> <span class="pl-en">merge</span>({}, state, {
          isFetching<span class="pl-k">:</span> <span class="pl-c1">false</span>,
        });
      <span class="pl-k">default</span><span class="pl-k">:</span>
        <span class="pl-k">return</span> state;
    }
  }

  <span class="pl-k">return</span> <span class="pl-k">function</span> <span class="pl-en">updatePaginationByKey</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> {}, <span class="pl-smi">action</span>) {
    <span class="pl-k">switch</span> (<span class="pl-smi">action</span>.<span class="pl-c1">type</span>) {
      <span class="pl-k">case</span> requestType<span class="pl-k">:</span>
      <span class="pl-k">case</span> successType<span class="pl-k">:</span>
      <span class="pl-k">case</span> failureType<span class="pl-k">:</span>
        <span class="pl-k">const</span> <span class="pl-c1">key</span> <span class="pl-k">=</span> <span class="pl-en">mapActionToKey</span>(action);
        <span class="pl-k">if</span> (<span class="pl-k">typeof</span> key <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>) {
          <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>Expected key to be a string.<span class="pl-pds">'</span></span>);
        }

        <span class="pl-k">return</span> <span class="pl-en">merge</span>({}, state, {
          [key]<span class="pl-k">:</span> <span class="pl-en">updatePagination</span>(state[key], action);
        });
      <span class="pl-k">default</span><span class="pl-k">:</span>
        <span class="pl-k">return</span> state;
    }
  };
}
</pre></div>

<hr>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/stlouisweb/redux-real-world-teardown">Redux Real-World Example Project Teardown</a> is maintained by <a href="https://github.com/stlouisweb">stlouisweb</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
